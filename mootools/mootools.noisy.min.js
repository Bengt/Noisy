var Noisy=new Class({Implements:Options,options:{intensity:0.9,size:200,opacity:0.08,fallback:"",monochrome:!1},initialize:function(a,b){a=this.element=document.id(a);if(!a)return!1;b&&this.setOptions(b)},noisify:function(a){var b=this.options,g=b.fallback,d=b.intensity,e=b.size,c=b.opacity;void 0!=a&&(a=this.getCachedUri(this.options));if(!a){if(this.hasCanvas()){var a=this.getCanvas(),f=a.getContext("2d"),d=this.getPixelIntensity(d,e),c=this.getMaxAlpha(c);a.width=a.height=e;this.randomizeImageData(f.createImageData(e,
e),d,c);a=a.toDataURL("image/png");if(0!=a.indexOf("data:image/png")||Browser.ie&&9>Browser.version&&32768<a.length)a=g}else a=this.options.fallback;this.setCachedUri(b,a)}this.element.setStyle("background-image","url("+a+")");return this},bitwiseRandomize:function(a){return~~(Math.random()*a)},updateCanvas:function(a){this.getCanvas().getContext("2d").putImageData(a,0,0);return this},randomizeImageData:function(a,b,g){var d=this.getCanvas(),e=this.options.monochrome;if(d.getContext("2d")){for(;b--;){var c=
this.bitwiseRandomize(d.width),f=this.bitwiseRandomize(d.height),c=4*(c+f*a.width),f=b%255;a.data[c]=f;a.data[c+1]=e?f:this.bitwiseRandomize(255);a.data[c+2]=e?f:this.bitwiseRandomize(255);a.data[c+3]=this.bitwiseRandomize(g)}this.updateCanvas(a)}return this},getPixelIntensity:function(a,b){return a*Math.pow(b,2)},getMaxAlpha:function(a){return 255*a},setCachedUri:function(a,b){this.hasLocalStorage()&&localStorage.setItem(JSON.encode(a),b);return this},getCachedUri:function(a){return this.hasLocalStorage()?
localStorage.getItem(JSON.encode(a)):!1},hasLocalStorage:function(){try{return localStorage.setItem("a","a"),localStorage.removeItem("a"),!0}catch(a){return!1}},setCanvas:function(){this.canvas=document.createElement("canvas");return this},getCanvas:function(){var a=this.canvas;a||(this.setCanvas(),a=this.canvas);return a},hasCanvas:function(){return!!this.getCanvas()}});
Element.Properties.noisy={set:function(a){this.get("noisy").setOptions(a);return this},get:function(){return this.retrieve("noisy",new Noisy(this))}};Element.implement({noisify:function(a){this.get("noisy").noisify(a);return this}});